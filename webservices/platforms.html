<html>
  <head>
    <meta charset="utf-8" />
    <title>Getting started with JSON Form</title>
    <link rel="stylesheet" href="deps/opt/bootstrap.css" />
  </head>
  <body>
    <h1>Getting started with JSON Form</h1>
    <form></form>
    <script type="text/javascript" src="deps/jquery.min.js"></script>
    <script type="text/javascript" src="deps/underscore.js"></script>
    <script type="text/javascript" src="lib/jsonform.js"></script>
    <script>
    </script>
  </body>
</html>

<script>
var xhr = new XMLHttpRequest();

function createForm(json){
    console.log(json);
    $('form').jsonForm({
        schema: {
            name: {
                status: 'string',
                title: 'Name',
                required: true
            },
            age: {
                type: 'number',
                title: 'Age'
            }
        },
        onSubmit: function (errors, values) {
            if (errors) {
                $('#res').html('<p>I beg your pardon?</p>');
            } else {
                $('#res').html('<p>Hello ' + values.name + '.' +
                    (values.age ? '<br/>You are ' + values.age + '.' : '') +
                    '</p>');
            }
        }
    });  
}

function poling(){
    // setInterval(() => {
        var obj = {
            "id":"FE_CC8Project001",
            "url":"192.168.1.14",
            "date":"1989-12-20T07:35:12.457Z"          
        }
        xhr.open('POST', 'http://localhost:8000/info', true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onload = function (e) {
            if ((xhr.readyState === 4) && (xhr.status === 200)) {
                createForm(xhr.responseText);
            }
          };
          xhr.onerror = function (e) {
            console.error(xhr.statusText + e);
          };
          xhr.send(JSON.stringify(obj)); 
    // }, 2000);
}

document.onreadystatechange = () => {
    if (document.readyState === 'complete') {
        poling();
    }  
};
</script>